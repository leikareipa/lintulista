<!DOCTYPE html>
<html>
    <head>
        <!-- Lintulista's root (assumes that this file is in "lintulista/tests/unit/").-->
        <base href="../../distributable/"/>
        
        <title>Lintulista - unit test results</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <link rel="stylesheet"
              href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
              integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP"
              crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="../tests/unit/unit-tests.css">
    </head>
    <body>
        <div id="title">
            Lintulista - unit test results
        </div>

        <div id="overall-result">
            <!-- An icon indicating whether all results succeeded or some failed will appear here.-->
        </div>

        <br>
        <div id="individual-results">
            <!-- The names of the individual units tested will appear here.-->
        </div>

        <br>
        <div id="finish-date">
            <!-- The time and date at which the tests finished will appear here.-->
        </div>

        <script src="./js/react/react.js"></script>
        <script src="./js/react/react-dom.js"></script>
        <script src="./js/react/react-dom-test-utils.js"></script>
        <script type="module">
            import {ObservationListMenuBar} from "./js/react-components/observation-list/ObservationListMenuBar.js";
            import {BirdSearchResult} from "./js/react-components/bird-search/BirdSearchResult.js";
            import {AsyncIconButton} from "./js/react-components/buttons/AsyncIconButton.js";
            import {ObservationCard} from "./js/react-components/observation-list/ObservationCard.js";
            import {BirdSearchBar} from "./js/react-components/bird-search/BirdSearchBar.js";
            import {ScrollerLabel} from "./js/react-components/scroller-label/ScrollerLabel.js";
            import {BirdThumbnail} from "./js/react-components/misc/BirdThumbnail.js";
            import {Observation} from "./js/observation.js";
            import {BirdSearch} from "./js/react-components/bird-search/BirdSearch.js";
            import {MenuButton} from "./js/react-components/buttons/MenuButton.js";
            import {Scroller} from "./js/react-components/scroller-label/Scroller.js";
            import {Bird} from "./js/bird.js";

            const unitsToTest =
            [
                Bird,
                Observation,
                Scroller,
                ScrollerLabel,
                BirdThumbnail,
                AsyncIconButton,
                MenuButton,
                BirdSearchBar,
                BirdSearchResult,
                BirdSearch,
                ObservationCard,
                ObservationListMenuBar,
            ];

            // Run the tests, and print out the results.
            (async()=>
            {
                let someTestsFail = false;

                for (const unit of unitsToTest)
                {
                    const testPasses = await unit.test();

                    someTestsFail = (!testPasses || someTestsFail);

                    // Add the result of this unit's test to the HTML.
                    {
                        const nameElement = document.createElement("span");
                        nameElement.style.whiteSpace = "nowrap";

                        if (testPasses)
                        {
                            nameElement.className = "pass";
                        }
                        else
                        {
                            nameElement.className = "fail";
                            nameElement.title = `${unit.name} fails`;
                        }

                        nameElement.appendChild(document.createTextNode(unit.name));
                        document.getElementById("individual-results").appendChild(nameElement);

                        if (unit !== unitsToTest[unitsToTest.length-1])
                        {
                            document.getElementById("individual-results").appendChild(document.createTextNode(", "));
                        }
                    }
                }

                if (someTestsFail)
                {
                    document.getElementById("overall-result").classList.add("fail");
                    document.getElementById("overall-result").title = "One or more tests fail";
                }
                else
                {
                    document.getElementById("overall-result").classList.add("pass");
                    document.getElementById("overall-result").title = "All tests pass";
                }

                document.getElementById("individual-results").style.visibility = "visible";

                document.getElementById("finish-date").appendChild(document.createTextNode(Date()));
            })();
        </script>
    </body>
</html>
