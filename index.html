<!DOCTYPE html>
<html>
    <head>
        <title>Lintulista!</title>
        <meta name="viewport" content="width=device-width">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <link href="https://fonts.googleapis.com/css?family=Nunito|Delius|Beth+Ellen&display=swap" rel="stylesheet"> 
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="index.css">
        <link rel="stylesheet" type="text/css" href="view-animations.css">
        <link rel="stylesheet" type="text/css" href="index-responsive.css">
    </head>
    <body>
        <header>

            <div id="image-lacking-notice">
                <i class="fas fa-exclamation-triangle"></i>
                Lintukuvat ovat tilapäisesti poissa käytöstä.
            </div>
            
            <div id="app-title" style="white-space: nowrap;">
                <span id="app-name">
                    lintulista
                    <i class="fas fa-feather-alt fa-sm" style="transform: translateY(-17px) translateX(-20px); z-index: 2;"></i>
                </span>
            </div>

            <div class="app-menu">
                <div class="app-menu-item"><a href="./guide/" target="_blank" rel="noopener noreferrer">käyttöohje</a></div>
                <div class="app-menu-item"><a href="mailto:sw@tarpeeksihyvaesoft.com">yhteydenotto</a></div>
            </div>
            
        </header>

        <div id="content">
            <div id="random-observations" style="overflow: hidden; display: flex; justify-content: center;"></div>
            <div id="create-new-list"></div>
        </div>

        <div id="info">
            <div class="entry">
                <div class="title">Mihin Lintulistaa käytetään?</div>
                <div class="text">
                    <p>Lintulistalla pidät kätevästi kirjaa eri lintulajien ensihavainnoistasi.</p>
                    <p>Pääset tarkastelemaan tekemiäsi lajihavaintoja kuvallisesta listasta havaintopäivämäärän
                    tai lajin nimen mukaan järjesteltynä.</p>
                    <p>Lintulista on taulukko-ohjelmaa mielenkiintoisempi tapa pysyä kartalla havainnoistaan!</p>
                </div>
            </div>
            <div class="entry">
                <div class="title">Mitä käyttäjältä vaaditaan?</div>
                <div class="text">
                    <p>Lintulistan käyttö on ilmaista; tarvitset vain modernin nettiselaimen.</p>
                    <p>Voit luoda itsellesi yhden tai useamman listan, jonka jälkeen pääset
                    merkitsemään havaintojasi.</p>
                    <p>Voit vaikkapa luoda erillisen listan kutakin linturetkeä
                    varten sekä pitää pidempiaikaisempaa listaa koko vuoden ensihavaintojen merkitsemiseen.</p>
    
                </div>
            </div>
            <div class="entry">
                <div class="title">Miten käytän Lintulistaa?</div>
                <div class="text">
                    <p>Kun olet luonut itsellesi listan (kts. sininen nappi, yllä), järjestelmä ilmoittaa sinulle
                    linkin, jonka kautta pääset muokkaamaan listaa.</p>
                    <p>Mutta ennen kuin luot uuden listan, luethan tarkoin Lintulistan käyttöohjeet, joihin löydät linkin
                    sivun ylälaidan valikosta.</p>
                    <p>Huomaathan, että listaan antamasi tiedot ovat julkisia. Tietojen saatavuutta ei voida taata.</p>
                </div>
            </div>
            <div class="entry">
                <div class="title">Kuka teki Lintulistan?</div>
                <div class="text">
                    <p>Lintulistan on kirjoittanut suomalainen koodiluola <a href="http://www.tarpeeksihyvaesoft.com">Tarpeeksi Hyvae Soft</a>.
                    <p>Lintulista on avointa lähdekoodia - löydät sen myös
                    <a href="https://www.github.com/leikareipa/lintulista">GitHubista</a>.</p>
                </div>
            </div>
        </div>

        <footer>
            <a href="https://www.github.com/leikareipa/lintulista">Lintulista</a>
            &bull; Designed & developed by <a href="http://www.tarpeeksihyvaesoft.com">Tarpeeksi Hyvae Soft</a> 2019
        </footer>

        <script src="https://unpkg.com/react@16.8.6/umd/react.development.js" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.development.js" crossorigin="anonymous"></script>
        <script type="module">
            import {ObservationCard} from "./client/dist/react-components/observation-list/ObservationCard.js"
            import {CreateNewListButton} from "./client/dist/react-components/buttons/CreateNewListButton.js";
            import {backend_access} from "./client/dist/backend-access.js";
            import {observation} from "./client/dist/observation.js";

            // Run the app.
            (async()=>
            {
                const knownBirds = await backend_access.get_known_birds_list();

                // Render a button with which the user can create a new list.
                {
                    const container = document.getElementById("create-new-list");

                    if (!container)
                    {
                        panic("Can't find a required container!");
                    }
                    else
                    {
                        ReactDOM.render(React.createElement(CreateNewListButton), container);
                    }
                }

                // Render a random selection of observations. (In the future, we might draw
                // a random sample from user-submitted observations, but for now, since there
                // are very few of those, we just generate random observations on the spot.)
                if (knownBirds.length)
                {
                    // Assumed (approximate) width in pixels of a single observation card element.
                    const observationCardWidth = 200;

                    const numObservationCards = Math.min(30, Math.max(3, (Math.floor(window.innerWidth / observationCardWidth) + 1)));
                    
                    const randomObservations = Array(numObservationCards).fill().reduce((cardArray, card, idx)=>
                    {
                        const randomDate = (()=>
                        {
                            const date = new Date();
                            date.setDate(Math.floor(Math.random() * 31));
                            date.setMonth(Math.floor(Math.random() * 12));

                            return date;
                        })();

                        cardArray.push(React.createElement(ObservationCard,
                        {
                            key: idx,
                            observation: observation(
                            {
                                date: randomDate,
                                bird: (()=>
                                {
                                    let bird;
                                    let loopCount = 0;
                                    const maxNumLoops = 1000;

                                    do
                                    {
                                        bird = knownBirds[Math.floor(Math.random() * knownBirds.length)];
                                    }
                                    while (/*(bird.thumbnailUrl === bird.nullThumbnailUrl) ||*/
                                           cardArray.map(c=>c.props.observation.bird.species).includes(bird.species) &&
                                           (++loopCount < maxNumLoops));

                                    return bird;
                                })(),
                            }),
                        }));

                        return cardArray;
                    }, []);

                    const container = document.getElementById("random-observations");

                    if (!container)
                    {
                        panic("Can't find a required container!");
                    }
                    else
                    {
                        ReactDOM.render(randomObservations, document.getElementById("random-observations"));
                    }
                }
            })();
        </script>
      </script>
    </body>
</html>
